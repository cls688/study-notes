[TOC]

# 一、nginx介绍



## 1、nginx概述

​		Nginx ("engine x") 是一个高性能的 HTTP 和反向代理服务器,特点是占有内存少，并发能力强，事实上 nginx 的并发能力确实在同类型的网页服务器中表现较好，中国大陆使用 nginx网站用户有：百度、京东、新浪、网易、腾讯、淘宝等。



## 2、Nginx 作为 web 服务器

[Nginx 可以作为静态页面的 web 服务器，同时还支持 CGI 协议的动态语言，比如 perl、php等。但是不支持 java。Java 程序只能通过与 tomcat 配合完成。Nginx 专为性能优化而开发，性能是其最重要的考量,实现上非常注重效率 ，能经受高负载的考验,有报告表明能支持高达 50,000 个并发连接数。](https://lnmp.org/nginx.html)



## 3、正向代理

nginx 不仅可以做反向代理，实现负载均衡。还能用作正向代理来进行上网等功能。

正向代理：如果把局域网外的 Internet 想象成一个巨大的资源库，则局域网中的客户端要访问 Internet，则需要通过代理服务器来访问，这种代理服务就称为正向代理。



## 4、反向代理

反向代理，其实客户端对代理是无感知的，因为客户端不需要任何配置就可以访问，我们只需要将请求发送到反向代理服务器，由反向代理服务器去选择目标服务器获取数据后，在返回给客户端，此时反向代理服务器和目标服务器对外就是一个服务器，暴露的是代理服务器地址，隐藏了真实服务器 IP 地址。



## 5、负载均衡

​		客户端发送多个请求到服务器，服务器处理请求，有一些可能要与数据库进行交互，服务器处理完毕后，再将结果返回给客户端。

​		这种架构模式对于早期的系统相对单一，并发请求相对较少的情况下是比较适合的，成本也低。但是随着信息数量的不断增长，访问量和数据量的飞速增长，以及系统业务的复杂度增加，这种架构会造成服务器相应客户端的请求日益缓慢，并发量特别大的时候，还容易造成服务器直接崩溃。很明显这是由于服务器性能的瓶颈造成的问题，那么如何解决这种情况呢？

​		我们首先想到的可能是升级服务器的配置，比如提高 CPU 执行频率，加大内存等提高机器的物理性能来解决此问题，但是我们知道[摩尔定律](https://www.cnblogs.com/ysocean/p/7641540.html)的日益失效，硬件的性能提升已经不能满足日益提升的需求了。最明显的一个例子，天猫双十一当天，某个热销商品的瞬时访问量是极其庞大的，那么类似上面的系统架构，将机器都增加到现有的顶级物理配置，都是不能够满足需求的。那么怎么办呢？

​		上面的分析我们去掉了增加服务器物理配置来解决问题的办法，也就是说纵向解决问题的办法行不通了，那么横向增加服务器的数量呢？这时候**集群**的概念产生了，*单个服务器解决不了，我们增加服务器的数量，然后将请求分发到各个服务器上，将原先请求集中到单个服务器上的情况改为将请求分发到多个服务器上，将负载分发到不同的服务器*，也就是我们所说的**负载均衡**。



## 6、动静分离

为了加快网站的解析速度，可以把动态页面和静态页面由不同的服务器来解析，加快解析速度。降低原来单个服务器的压力。



# 二、安装nginx



1.官网下载nginx

http://nginx.org/

**需要的依赖*pcre*、*openssl*、*zlib*、*nginx***

2.一键安装

```shell
yum -y install gcc zlib zlib-devel pcre-devel openssl openssl-devel
```

3.安装nginx

解压nginx-xx-.tar.gz

```shell
tar -xvf nginx-xx-.tar.gz
```

进入解压缩目录，执行

```shell
./configure
```

解析安装

```shell
make && make install
```



***防火墙开放端口号***

查看开放端口号

```shell
firewall-cmd --list-all
```

设置开放端口号（80端口）

```shell
firewall-cmd --add-service=http -permanent
```

```shell
firewall-cmd --add-port=80/tcp --permanent
```

重启防火墙

```shell
firewall-cmd -reload
```



# 三、nginx常用命令



需在目录中使用

```shell
cd /usr/local/nginx/sbin/
```

启动

```shell
./nginx
```

关闭

```shell
./nginx -s stop
```

重载

```shell
./nginx -s reload
```

查看nginx进程

```shell
ps -ef grep | nginx
```

查看版本号

```shell
./nginx -v
```



# 四、nginx配置文件



## 1、位置

​		nginx 安装目录下，其默认的配置文件都放在这个目录的 conf 目录下，而主配置文件nginx.conf 也在其中，后续对 nginx 的使用基本上都是对此配置文件进行相应的修改。

```shell
cd /usr/local/nginx/conf/
```



## 1、组成

1. 全局

   ​		影响nginx服务器整体运行的配置指令，主要包括配置运行nginx服务器的用户（组）、允许生成的worker process数，进程PID存放路径、日志存放路径和类型以及配置文件的引入等。

   ​		比如：

   ```co
   worker_process 1;
   ```

   ​		这是 Nginx 服务器并发处理服务的关键配置，worker_processes 值越大，可以支持的并发处理量也越多，但是会受到硬件、软件等设备的制约.

2. events

   ​		events 块涉及的指令主要影响 Nginx 服务器与用户的网络连接，常用的设置包括是否开启对多 work process 下的网络连接进行序列化，是否允许同时接收多个网络连接，选取哪种事件驱动模型来处理连接请求，每个 word process 可以同时支持的最大连接数等。

   ```
   events {
       worker_connections 1024;
   }
   ```

   ​		上述例子就表示每个 work process 支持的最大连接数为 1024。

   ​		这部分的配置对 Nginx 的性能影响较大，在实际中应该灵活配置。

3. http

   这算是 Nginx 服务器配置中最频繁的部分，代理、缓存和日志定义等绝大多数功能和第三方模块的配置都在这里。

   需要注意的是：http 块也可以包括 **http 全局块**、**server 块**。

   **①、http 全局块**

   http 全局块配置的指令包括文件引入、MIME-TYPE 定义、日志自定义、连接超时时间、单链接请求数上限等。

   **②、server 块**

   这块和虚拟主机有密切关系，虚拟主机从用户角度看，和一台独立的硬件主机是完全一样的，该技术的产生是为了节省互联网服务器硬件成本。

   

   每个 http 块可以包括多个 server 块，而每个 server 块就相当于一个虚拟主机。

   而每个 server 块也分为全局 server 块，以及可以同时包含多个 location 块。

   **1、全局 server 块**

   最常见的配置是本虚拟机主机的监听配置和本虚拟主机的名称或 IP 配置。

   **2、location 块**

   一个 server 块可以配置多个 location 块。

   这块的主要作用是基于Nginx服务器接收到的请求字符串（例如 server_name/url-string），对虚拟主机名称（也可以是 IP 别名）之外的字符串（例如 前面的 /url-string）进行匹配，对特定的请求进行处理。地址定向、数据缓存和应答控制等功能，还有许多第三方模块的配置也在这里进行。

